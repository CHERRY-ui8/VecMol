defaults:
  - dset: drugs
  - encoder: gnn_large
  - decoder: decoder_global_large
  - denoiser: gnn
  - converter: gnf_converter_drugs
  - override hydra/job_logging: custom
  - _self_

debug: False
wandb: True
seed: 1234

diffusion_method: "new_x0"  # "old" (WJS) 或 "new" (DDPM) 或 "new_x0" (DDPM with x0)

# DDPM配置（仅当diffusion_method为"new"时使用）
ddpm:  
  # 扩散过程配置
  beta_start: 1e-4
  beta_end: 0.02
  num_timesteps: 1000
  schedule: "cosine"  # 可选: "linear", "cosine", "sigmoid"
  
  # Cosine调度参数（仅当schedule为"cosine"时使用）
  s: 0.008  # cosine调度的偏移参数，控制余弦曲线的偏移，影响噪声添加的曲线形状（s越小曲线越陡峭，s越大曲线越平缓）
  
  # Sigmoid调度参数（仅当schedule为"sigmoid"时使用）
  s1: 0.008
  sT: 0.008
  w: 1.0

  # 损失权重配置（仅当diffusion_method为"new_x0"时使用）
  use_time_weight: False  # 是否使用时间步权重 1 + num_timesteps/(t+1)

# NOTE: 位置权重配置
# 根据每个grid坐标附近原子的数量计算权重，对重要位置的codes在loss计算时加大权重
position_weight:
  enabled: False  # 是否启用位置权重
  radius: 3.0     # 计算附近原子的半径阈值（单位：埃） 2, 3
  alpha: 0.5      # 权重系数：weight = 1 + alpha * num_atoms


nf_pretrained_path: /datapool/data2/home/pxg/data/hyc/funcmol-main-neuralfield/exps/neural_field/nf_drugs/20260113/lightning_logs/version_1/checkpoints/last.ckpt
exp_dir: ../exps/funcmol
exp_name: "fm_${dset.dset_name}/${now:%Y%m%d}" # NOTE: in lightning, no time stamp needed
dirname: "${exp_dir}/${exp_name}"
reload_model_path: null

# data params
smooth_sigma: 0.5
normalize_codes: 1
on_the_fly: False  # use False if codes are computed offline.

use_augmented_codes: False  # True: 使用数据增强的codes, False: 使用原始codes（不使用数据增强）
num_augmentations: 1  # null 或具体数字（如 3, 5, 10 等）

# LMDB配置
use_sharded_lmdb: True  # 是否使用分片LMDB。null=自动检测（优先使用分片），true=强制使用分片，false=强制使用完整LMDB

codes_dir_no_aug: "/datapool/data2/home/pxg/data/hyc/funcmol-main-neuralfield/exps/neural_field/nf_drugs/20260113/lightning_logs/version_1/checkpoints/code_no_aug/"
codes_dir_with_aug: "/datapool/data3/storage/pengxingang/pxg/hyc/funcmol-main-neuralfield/exps/neural_field/nf_drugs/20260113/lightning_logs/version_1/checkpoints/codes_no_shuffle/"

# training params
num_epochs: 5000
dset:
  batch_size: 30
  num_workers: 4

ckpt_every_n_epochs: 1  # 每隔多少epoch保存一次ckpt
decoder:
  code_dim: 384 # 和encoder的code_dim一致

# optim params
lr: 5e-4 # 1e-3 # 5e-4
use_lr_schedule: 0
num_warmup_iter: 4000
wd: 1e-6
ema_decay: 0.999
max_grad_norm: 0.5  # 梯度裁剪阈值，防止梯度爆炸

# set the running dir
hydra:
  run:
    dir: ${dirname}
  job:
    config:
      override_dirname:
        kv_sep: ""
        item_sep: "_"
        exclude_keys: ["exp_dir"]
